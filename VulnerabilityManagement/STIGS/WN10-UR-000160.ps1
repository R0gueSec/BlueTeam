<#
.SYNOPSIS
    Restrict 'Restore files and directories' user right to Administrators group.

.NOTES
    Author          : RogueSec
    Website         : www.roguesec.net
    GitHub          : github.com/R0gueSec
    Date Created    : 2025-07-06
    Last Modified   : 2025-07-06
    Version         : 1.1
    STIG-ID         : WN10-UR-000160

.TESTED ON
    Date(s) Tested  : 2025-07-06
    Tested By       : RogueSec
    Systems Tested  : Windows 10 22H2
    PowerShell Ver. : 5.1

.USAGE
    PS C:\> .\WN10-UR-000160.ps1
#>

$cfgPath = "C:\\secpol.cfg"
$adminSID = "*S-1-5-32-544"

# Export current local security policy
secedit /export /cfg $cfgPath

# Replace the Restore privilege line safely
(Get-Content $cfgPath) -replace '^SeRestorePrivilege\s*=.*', "SeRestorePrivilege = $adminSID" | Set-Content $cfgPath

# Apply the modified policy
secedit /configure /db secedit.sdb /cfg $cfgPath /areas USER_RIGHTS

# Cleanup
Remove-Item $cfgPath -Force

Write-Host "'Restore files and directories' privilege restricted to Administrators."
